@{
    ViewData["Title"] = "Login";
}

@{
    Layout = "_Layout";
}

<div class="my-5">
    <div class="mx-5 my-3 w-25">
        <h1 class="mb-3">@ViewData["Title"]</h1>
        <form id="loginForm">
            <label class="fw-bold" for="user">Usuario:</label>
            <input type="text" class="form-control mb-3" id="user" />

            <label class="fw-bold" for="password">Contraseña:</label>
            <input type="password" class="form-control mb-3" id="password" />

            <button onclick="iniciarSesion()" type="button" class="btn btn-primary">Iniciar sesión</button>
            <button onclick="cancelar()" type="button" class="btn btn-secondary">Cancelar</button>            
        </form>
    </div>
</div>

<script src="~/lib/jquery/dist/jquery.min.js"></script>
<script>

    $("#loginForm").submit(function(event){
        var isValid = false;

        if (!isValid) {
            event.preventDefault();
        }
    });

    $("#user").keyup(function (event) {
        if (event.keyCode === 13) {
            iniciarSesion();
        }
    });

    $("#password").keyup(function (event) {
        if (event.keyCode === 13) {
            iniciarSesion();
        }
    });

    function cancelar(){
        $.ajax({
            cache: false,
            type: "GET",
            url: '@Url.Action("Cancelar", "Home")',
            data: null,
            success: function (response) {
                if (response == null) {
                    showToastError("Ha ocurrido un error");
                    return;
                }
                window.location.href = response.redirectToUrl;
            },
            error: function (xhr) {
                showToastError(xhr.responseText);
                return false;
            },
            beforeSend: function () {
                mostrarCarga(true);
            },
            complete: function () {
                mostrarCarga(false);
            }
        });
    }

    function iniciarSesion(){
        if($("#user").val() == '' || $("#password").val() == ''){
            showToastError('Debe ingresar el usuario y contraseña')
            return
        }

        var request = {
            Usuario: $("#user").val(),
            Password: $("#password").val()
        }

        $.ajax({
            cache: false,
            type: "POST",
            url: '@Url.Action("IniciarSesion", "Operaciones")',
            data: request,
            success: function (response) {
                if (response == null) {
                    showToastError("Ha ocurrido un error");
                    return;
                }
                showToastOk('Se inició sesión correctamente');
                window.location.href = response.redirectToUrl;
            },
            error: function (xhr) {
                showToastError(xhr.responseText);
                return false;
            },
            beforeSend: function () {
                mostrarCarga(true);
            },
            complete: function () {
                mostrarCarga(false);
            }
        });
    }

</script>